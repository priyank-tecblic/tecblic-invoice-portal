<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="static/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="icon" type="image/x-icon" href="/static/tecblic.png">

<style>
        * {
          box-sizing: border-box;
        }
        
        input[type=text], select, textarea {
          width: 100%;
          padding: 12px;
          border: 1px solid #ccc;
          border-radius: 4px;
          resize: vertical;
        }
        
        label {
          padding: 12px 12px 12px 0;
          display: inline-block;
        }
        
        input[type=submit] {
          background-color: #04AA6D;
          color: white;
          padding: 12px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          float: right;
        }
        
        input[type=submit]:hover {
          background-color: #45a049;
        }
        
        .container {
          border-radius: 5px;
          background-color: #f2f2f2;
          padding: 20px;
        }
        
        .col-25 {
          float: left;
          width: 25%;
          margin-top: 6px;
        }
        
        .col-75 {
          float: left;
          width: 75%;
          margin-top: 6px;
        }
        
        /* Clear floats after the columns */
        .row:after {
          content: "";
          display: table;
          clear: both;
        }
        
        /* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
          .col-25, .col-75, input[type=submit] {
            width: 100%;
            margin-top: 0;
          }
        }
        #s4
            {
                color: white;
            }
        </style>
   
    
    <title>Document</title>
</head>
<body>
{% include 'tecblicapp/navbar.html' %}
{% block content %}

{% endblock %}
<hr>
<div class="container">

    <!-- <div class="row" style="font-family: Georgia, 'Times New Roman', Times, serif; ">
        <div class="col-sm-4">
            <h4 class="text-center alert alert-info" style="background-color: #e6f7ff;">Add/Update Client Details</h4>
            <form id="form" action="add" method="POST">
                {% csrf_token %}
                <input type="hidden" name="cli_id" id="client_id">
                {{form.as_p}}
                <input type="submit" class="btn btn-success" id="btnsave" value="Save">
            </form>
        </div> -->
        {% csrf_token %}
        <div class="text-center" style="font-family: Georgia, 'Times New Roman', Times, serif;">
            <h4 class="text-center alert alert-info" style="font-size: 35px;background-color: #e6f7ff;">Client Details</h4>
<!-- Button trigger modal -->
<button type="button" class="btn btn-outline-secondary" style="position: relative;bottom: 65px;left: 45.9%;" data-bs-toggle="modal" data-bs-target="#exampleModal">
    Add
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title font-weight-bold bg-light" style="margin-left:33%;font-size: 35px;" id="exampleModalLabel">Add Client</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form action="{% url 'save' %}" method="post">
                {% csrf_token %}
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="name"  placeholder="name@example.com">
                    <label for="floatingInput">Client Name</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" name="email" placeholder="name@example.com">
                    <label for="floatingInput">Client Email</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="address" placeholder="name@example.com">
                    <label for="floatingInput">Client Address</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="gstin" placeholder="name@example.com">
                    <label for="floatingInput">Client GSTIN</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="pan" placeholder="name@example.com">
                    <label for="floatingInput">Client PAN</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="kind" placeholder="name@example.com">
                    <label for="floatingInput">Kind Attn</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" name="place" id="floatingInput" placeholder="Ahmedabad ">
                    <label for="floatingInput">Place of Supply</label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-dark">Save</button>
                </div>
            </form>
            </div>
        </div>
    </div>
  </div>
            <table class="table table-hover">
                <thead>
                    <tr id="heading">
                        <th scope="col">Client Name</th>
                        <th scope="col">Client Email</th>
                        <th scope="col">Client Address</th>
                        <th scope="col">Client GSTIN</th>
                        <th scope="col">Client PAN</th>
                        <th scope="col">KindAttn</th>
                        <th scope="col">Place of Supply</th>
                        <th scope="col">Edit</th>
                        <!-- <th scope="col">Delete</th> -->
                        
                    </tr>
                </thead>
                <tbody id="tbody">
                    {% for cl in clientdetails %}
                    <tr>
                        <!-- <td>{{ cl.id }}</td> -->
                        <td id="name{{ cl.id }}">{{ cl.clientName }}</td>
                        <td id="email{{ cl.id }}">{{ cl.clientEmail }}</td>
                        <td id="address{{ cl.id }}">{{ cl.clientAddress }}</td>
                        <td id="gst{{ cl.id }}">{{ cl.clientGSTIN }}</td>
                        <td id="pan{{ cl.id }}">{{ cl.clientPAN }}</td>
                        <td id="kind{{ cl.id }}">{{ cl.kindAttn }}</td>
                        <td id="place{{ cl.id }}">{{ cl.placeofSupply }}</td>
                        <td><input type="button" data-sid="{{cl.id}}" id="e{{cl.id}}" class="button btn btn-warning btn-edit" value="Edit"></td>
                        <!-- <td><input type="button" data-sid="{{cl.id}}" id="d{{cl.id}}" class="button btn btn-danger btn-del"  value="Delete"></td> -->
                    </tr>
                    
                    
                    {% endfor %}
                </tbody>
                
            </table>
            
        </div>
    </div>
</div>
<nav aria-label="Page navigation example" class="mt-4" style="margin: auto;width: 25%;">
    <ul class="pagination" style="justify-content: center;">
        {% if clientdetails.has_previous %}
        <li class="page-item"><a class="page-link text-dark" href="/add?page={{clientdetails.previous_page_number}}">Previous</a></li>
        {% endif %}
        {% for i in totalpages %}
        <li class="page-item "><a class="page-link 
            {% if clientdetails.number == i %}
            bg-dark text-light 
            {% else %}
             bg-light text-dark
            {% endif %}
            " href="/add?page={{i}}">{{i}}</a></li>
            {% endfor %}
            {% if clientdetails.has_next %}
            <li class="page-item"><a class="page-link text-dark" href="/add?page={{clientdetails.next_page_number}}">Next</a></li>
            {% endif %}
        </ul>
    </nav>
    <script>
        $('#btnsave').click(function(){
    
            let client_id=$("#client_id").val();
            
            let name=$("#nameid").val();
            
            
            let address=$('#addressid').val();
            
            let gstin=$('#gstinid').val();
            
            let pan=$('#panid').val();
            let email=$('#emailid').val()
            let kind=$('#kindattnid').val()
            let place=$('#placeid').val()
            
            
            
            var csrf_token = $('input[name="csrfmiddlewaretoken"]').val()
            
            
            if(name==""){
                console.log('Please enter name')
            }else if(address==""){
                console.log('Please enter Adress')
            }else if(gstin==""){
                console.log('Please enter GSTIN')
            }else if(pan==""){
                console.log('Please enter PAN')
            }else{
                
                mydata={name:name,address:address,gstin:gstin,pan:pan,'csrfmiddlewaretoken':csrf_token,'cli_id':client_id,email:email,kind:kind,place:place}
                $.ajax({
                    url:"{% url 'save' %}",
                    method:"POST",
                    data:mydata,
                    success:function(data){
                        
                        if(data.status=="Save"){
                            console.log('form submitted successfully')
                            alert('Your data saved successfully')
                            
                            $("form")[0].reset();
                            
                        }
                        if(data.status==0){
                            console.log('your form not submitted')
                        }
                        
                        
                    }
                })
            }
            
            
        });
        
        $("tbody").on("click",".btn-del",function(){
            console.log('delete butto clicked');
            let id=$(this).attr("data-sid");
            var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
            
            mydata={cid:id,'csrfmiddlewaretoken':csrf_token}
            mythis=this;
            $.ajax({
                url:"{% url 'delete' %}",
                method:"POST",
                data:mydata,
                success:function(data){
                    if(data.status==1){
                        $(mythis).closest("tr").fadeOut();
                        alert('You data is deleted successfully')
                    }
            }
        })
    })

    $("tbody").on("click",".btn-edit",function(){
        console.log('edit butto clicked');
        let id=$(this).attr("data-sid");
        
        console.log(id)
        $('#name'+id).html('<input type="text" value="'+$('#name'+id).html()+'">')
        $('#email'+id).html('<input type="text" value="'+$('#email'+id).html()+'">')
        $('#address'+id).html('<input type="text" value="'+$('#address'+id).html()+'">')
        $('#gst'+id).html('<input type="text" value="'+$('#gst'+id).html()+'">')
        $('#pan'+id).html('<input type="text" value="'+$('#pan'+id).html()+'">')
        $('#kind'+id).html('<input type="text" value="'+$('#kind'+id).html()+'">')
        $('#place'+id).html('<input type="text" value="'+$('#place'+id).html()+'">')
        $(this).val("Submit")
        $('#d'+id).val("cancel")
        
        $(this).attr('id', $(this).attr('id').replace('e', 's'));
        $(this).attr('class', $(this).attr('class').replace('btn-edit', 'sub'));
        $('<td><input type="button"  id="c'+id+'" class="button btn btn-danger cancel"  value="Cancel"></td>').insertAfter($(this).parent());
        // $('#d'+id).addClass('cancel');
        // $('#d'+id).attr('class', $('#d'+id).attr('class').replace('btn-del', ' dd'));
        // $('#d'+id).attr('id', $('#d'+id).attr('id').replace('d', 'c'));
        // console.log($('#name'+id).children()[0].value)
        $("#heading").append('<th scope="col">Cancel</th>')
        
    })
    
    $("tbody").on("click",".cancel",function(){
        // let id=$(this).attr("id");
        // id = id.split("")[1]
        // var address = $('#address'+id).children()[0].value
        // var gstin = $('#gst'+id).children()[0].value
        // var pan = $('#pan'+id).children()[0].value
        // var name = $('#name'+id).children()[0].value
        // var email = $('#email'+id).children()[0].value
        // var kind = $('#kind'+id).children()[0].value
        // var place = $('#place'+id).children()[0].value
        // $('#address'+id).html(address)
        // $('#gst'+id).html(gstin)
        // $('#pan'+id).html(pan)
        // $('#name'+id).html(name)
        // $('#email'+id).html(email)
        // $('#kind'+id).html(kind)
        // $('#place'+id).html(place)
        location.reload()
    });
    $("tbody").on("click",".sub",function(){

        let id=$(this).attr("data-sid");
        var address = $('#address'+id).children()[0].value
        var gstin = $('#gst'+id).children()[0].value
        var pan = $('#pan'+id).children()[0].value
        var name = $('#name'+id).children()[0].value
        var pan = $('#pan'+id).children()[0].value
        var email = $('#email'+id).children()[0].value
        var kind = $('#kind'+id).children()[0].value
        var place = $('#place'+id).children()[0].value
        
        var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
        console.log(id,address,csrf_token)
        // mydata={cid:id,'csrfmiddlewaretoken':csrf_token}
        mydata={'name':name,'address':address,'gstin':gstin,'pan':pan,'csrfmiddlewaretoken':csrf_token,'cli_id':id,'email':email,'kind':kind,'place':place}
        console.log(mydata)
                $.ajax({
                    url:"{% url 'save' %}",
                    method:"POST",
                    data:mydata,
                    success:function(data){
                        
                        
                        if(data.status==0){
                            console.log('your form not submitted')
                        }
                        else{
                            console.log('form submitted successfully')
                                                        
                            location.reload();
                            
                        }
                        
                    }
                })
            }

        // $.ajax({
        //     url:"{% url 'edit' %}",
        //     method:"POST",
        //     data:mydata,
        //     dataType:"json",
        //     success:function(data){
        //         console.log(data)
        //         $("#client_id").val(data.id);
                
        //         $("#nameid").val(data.name);
        //         $("#addressid").val(data.address);
        //         $("#gstinid").val(data.gstin);
        //         $("#panid").val(data.pan);
        //         $("#emailid").val(data.email);
        //         $("#kindattnid").val(data.kind);
        //         $("#placeid").val(data.place);
                
                
                
        //     }
        // })
    );
</script>

</body>
</html>